<!doctype html><html><head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="Yet another tech blog">
<link rel="shortcut icon" href=https://mhwdvs.github.io/favicon.ico>
<link rel=stylesheet href=/css/style.min.css>
<title>Using git-crypt</title>
</head>
<body><header id=banner>
<h2><a href=https://mhwdvs.github.io/>(m)att(h)e(w) (d)a(v)i(s)</a></h2>
<nav>
<ul>
<li>
<a href=/posts title=posts>posts</a>
</li>
</ul>
</nav>
</header>
<main id=content>
<article>
<header id=post-header>
<h1>Using git-crypt</h1>
<div>
<time>January 5, 2022</time>
</div>
</header><p><code>git-crypt</code> is a simple tool for encrypting files in a git repository. It&rsquo;s good for both text and binary files, and ideal for public repositories, protecting files that are both sensible to source control (ie. that shouldn&rsquo;t be in your <code>.gitignore</code>), but contain sensitive info you might not want public. My first use case is for my Nix/NixOS/home-manager configuration (<a href>https://github.com/mhwdvs/hm/</a>), where I need to add some sensitive configuration details for work, but still want to source control my changes and conveniently access the configuration across multiple machines.</p>
<p>Let&rsquo;s get started.</p>
<h2 id=i-havent-used-git-crypt-before-and-dont-have-a-key-yet-or-i-want-a-new-key-for-every-repository-i-use-git-crypt-in>I haven&rsquo;t used git-crypt before and don&rsquo;t have a key yet, or I want a new key for every repository I use <code>git-crypt</code> in</h2>
<ul>
<li><code>git-crypt init</code></li>
<li><code>git-crypt export-key ./git-crypt-key</code> (will output file <code>git-crypt-key</code>, your symmetric key)</li>
</ul>
<h2 id=i-already-have-a-key-from-git-crypt-and-i-want-to-use-it-for-another-repository>I already have a key from git-crypt and I want to use it for another repository</h2>
<ul>
<li>Commit at least one file to the repository (not one that should be encrypted). A good first file may be a <code>README.md</code> or <code>.gitignore</code></li>
<li><code>git-crypt init</code></li>
<li><code>git-crypt decrypt &lt;common PGP key file></code></li>
</ul>
<h2 id=createappend-gitattributes>Create/Append <code>.gitattributes</code></h2>
<p>This is where we add rules that tell git-crypt what files it should encrypt. <code>.gitattributes</code> should be created at the root of your git repository if it doesn&rsquo;t already exist. The lines you add to it for <code>git-crypt</code> should look something like this;</p>
<pre tabindex=0><code>&lt;file name&gt; filter=git-crypt diff=git-crypt
</code></pre><p>The file name can be a literal file name, or utilise wildcards (<code>*</code>) to target many files (eg. <code>*.key</code> to encrypt all files ending in <code>.key</code>), or use any other logic git supports in it&rsquo;s <code>.gitattributes</code>.</p>
<p>Commit this file to your git repository.</p>
<h2 id=add-your-secret-files>Add your secret files</h2>
<p>What the heading says.</p>
<p><code>git-crypt status</code> will tell you what files it is managing. Note that you don&rsquo;t have to commit secret files to your repository for them to show as &ldquo;encrypted&rdquo; in this dialog, so you have the opportunity to check that everything is working as intended before committing your secrets and potentially having them be pushed out into the public.</p>
</article>
</main><footer id=footer>
Copyright Â© 2021 Matthew Davis
</footer>
</body>
</html>